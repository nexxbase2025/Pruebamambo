
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RADIO MAMBO</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000"/>
  <link rel="apple-touch-icon" href="iconomambo.png" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Redes sociales horizontales arriba del reproductor */
    .social-bubbles {
      position: relative;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 20px;
      z-index: 9999;
      flex-wrap: wrap;
    }

    .social-bubbles a {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background-color: #ffffff;
      position: relative;
      overflow: hidden;
      animation: pulseGlow 2s infinite ease-in-out;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .social-bubbles a:hover {
      transform: scale(1.15);
      box-shadow: 0 0 30px rgba(255,255,255,0.9);
    }

    .social-bubbles img {
      width: 35px;
      height: 35px;
      z-index: 2;
    }

    /* Destello animado */
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 10px rgba(255,255,255,0.4); }
      50% { box-shadow: 0 0 25px rgba(255,255,255,0.9); }
      100% { box-shadow: 0 0 10px rgba(255,255,255,0.4); }
    }

    @media (max-width: 480px) {
      .social-bubbles {
        gap: 12px;
      }
      .social-bubbles a {
        width: 45px;
        height: 45px;
      }
      .social-bubbles img {
        width: 45px;
        height: 45px;
      }
    }

    /* Botón flotante de compartir */
    #share-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: #40a8f4;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      cursor: pointer;
      z-index: 10001;
      animation: pulseGlow 2s infinite ease-in-out;
      transition: transform 0.2s ease;
    }

    #share-btn:hover {
      transform: scale(1.1);
      background: #1f75d1;
    }

    #share-btn img {
      width: 40px;
      height: 40px;
      filter: invert(1);
    }

    @media (max-width: 480px) {
      #share-btn {
        width: 48px;
        height: 48px;
      }
      #share-btn img {
        width: 45px;
        height: 45px;
      }
    }
  </style>
</head>
<body>
  <!-- Botón de compartir -->
  <div id="share-btn" title="Compartir">
    <img src="share.png" alt="Compartir" />
  </div>

  <!-- Redes sociales con íconos locales -->
  <div class="social-bubbles">
    <a href="https://www.facebook.com/profile.php?id=61566406267706" target="_blank" title="Facebook">
      <img src="facebook.png" alt="Facebook" />
    </a>
    <a href="https://www.instagram.com/radiomambo5?igsh=bjNtMm0yODZhbzY3&utm_source=qr" target="_blank" title="Instagram">
      <img src="instagram.png" alt="Instagram" />
    </a>
    <a href="https://www.tiktok.com/@radiomambo5?_t=ZP-8x0fjY7f5xO&_r=1" target="_blank" title="TikTok">
      <img src="tiktok.png" alt="TikTok" />
    </a>
  </div>

  <!-- Reproductor -->
  <div class="radio-player">
    <button class="play-btn" id="playPauseBtn">▶</button>
    <div class="spectrum" id="spectrum"></div>
  </div>

  <audio id="audio" preload="auto"></audio>

  <!-- Burbuja instalar para Android -->
  <div id="install-bubble" style="display:none;">📲 Instalar app</div>

  <!-- Cuadro info iPhone -->
  <div id="ios-install-info" style="display:none;">
    Para instalar esta app en tu iPhone, toca el botón <strong>Compartir</strong> y luego <strong>Agregar a pantalla de inicio</strong>.
    <button id="close-ios-info">Cerrar</button>
  </div>

  <script>
    const audio = document.getElementById('audio');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const spectrum = document.getElementById('spectrum');
    let isPlaying = false;
    let animationId;

    const STREAM_URL = "https://stream.zeno.fm/utwmdnuwlafuv";

    // Crear barras del espectro
    const bars = [];
    for (let i = 0; i < 16; i++) {
      const bar = document.createElement('div');
      bar.className = 'bar';
      spectrum.appendChild(bar);
      bars.push(bar);
    }

    function animateFakeSpectrum() {
      bars.forEach((bar) => {
        const height = Math.random() * 100;
        bar.style.height = height + '%';
      });
      animationId = requestAnimationFrame(animateFakeSpectrum);
    }

    // ---- Precargar stream ----
    window.addEventListener('load', () => {
      audio.src = STREAM_URL;
      audio.load();
    });

    // ---- PLAY / STOP ----
    playPauseBtn.addEventListener('click', () => {
      if (!isPlaying) {
        audio.src = STREAM_URL;
        audio.volume = 1;
        audio.play().then(() => {
          playPauseBtn.textContent = '⏹'; // STOP
          animateFakeSpectrum();
          isPlaying = true;
        }).catch(err => {
          console.error('Error al reproducir:', err);
        });
      } else {
        audio.pause();
        audio.src = '';
        playPauseBtn.textContent = '▶'; // PLAY
        cancelAnimationFrame(animationId);
        isPlaying = false;
      }
    });

    // ---- Fade-in tras interrupciones ----
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible' && isPlaying) {
        audio.pause();
        audio.src = STREAM_URL;
        audio.play().then(() => {
          audio.volume = 0;
          let v = 0;
          const fade = setInterval(() => {
            if (v < 1) {
              v += 0.1;
              audio.volume = v;
            } else {
              clearInterval(fade);
            }
          }, 100);
        }).catch(err => {
          console.error('Error al reanudar el stream:', err);
        });
      }
    });

    // ---- Reconexión automática ----
    function reconnect() {
      if (isPlaying) {
        audio.pause();
        audio.src = STREAM_URL;
        audio.play().catch(err => console.error("Reintento:", err));
      }
    }

    audio.addEventListener('stalled', reconnect);
    audio.addEventListener('error', reconnect);

    // ---- Redes sociales externo ----
    document.querySelectorAll('.social-bubbles a').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const url = link.href;
        window.open(url, '_blank', 'noopener,noreferrer');
      });
    });

    // ---- Botón de compartir ----
    document.getElementById('share-btn').addEventListener('click', async () => {
      const shareData = {
        title: "Radio Mambo",
        text: "Escucha Radio Mambo en vivo 🎶📲",
        url: "https://tu-enlace-aqui.com" // <-- cámbialo por tu link real
      };
      if (navigator.share) {
        try {
          await navigator.share(shareData);
          console.log("Compartido exitosamente");
        } catch (err) {
          console.warn("No se pudo compartir:", err);
        }
      } else {
        alert("La función de compartir no es compatible en este navegador.");
      }
    });

    // -- PWA INSTALACIÓN --
    let deferredPrompt;
    const installBubble = document.getElementById('install-bubble');
    const iosInstallInfo = document.getElementById('ios-install-info');
    const closeIosBtn = document.getElementById('close-ios-info');
    const isAndroid = /android/i.test(navigator.userAgent);
    const isIos = /iphone|ipad|ipod/i.test(navigator.userAgent);

    window.addEventListener('beforeinstallprompt', (e) => {
      if (isAndroid) {
        e.preventDefault();
        deferredPrompt = e;
        installBubble.style.display = 'block';
      }
    });

    installBubble.addEventListener('click', async () => {
      installBubble.style.display = 'none';
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      }
    });

    window.addEventListener('load', () => {
      if (isIos && !window.matchMedia('(display-mode: standalone)').matches) {
        if (!localStorage.getItem('iosInstallInfoClosed')) {
          iosInstallInfo.style.display = 'block';
        }
      }
    });

    closeIosBtn.addEventListener('click', () => {
      iosInstallInfo.style.display = 'none';
      localStorage.setItem('iosInstallInfoClosed', 'true');
    });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>